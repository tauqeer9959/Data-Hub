import{j as e,am as n,u as H,r as i,at as N,C as c,b as l,e as d,d as o,au as z,i as V,k as Y,l as v,m as y,o as w,I as M,B as p,n as q,p as _,t as h}from"./index-BpTcuRSl.js";import{A as G}from"./activity-D7tI26iW.js";import{S as J}from"./search-BlKAaIYe.js";function K({className:t,...a}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:n("w-full caption-bottom text-sm",t),...a})})}function O({className:t,...a}){return e.jsx("thead",{"data-slot":"table-header",className:n("[&_tr]:border-b",t),...a})}function Q({className:t,...a}){return e.jsx("tbody",{"data-slot":"table-body",className:n("[&_tr:last-child]:border-0",t),...a})}function A({className:t,...a}){return e.jsx("tr",{"data-slot":"table-row",className:n("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function x({className:t,...a}){return e.jsx("th",{"data-slot":"table-head",className:n("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function m({className:t,...a}){return e.jsx("td",{"data-slot":"table-cell",className:n("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function ee(){const{session:t,profile:a}=H(),[u,C]=i.useState([]),[j,T]=i.useState([]),[k,g]=i.useState(!0),[f,U]=i.useState(""),L=async()=>{if(!(!t?.access_token||a?.role!=="admin"))try{const s=await fetch(`https://${_}.supabase.co/functions/v1/make-server-0603cad1/admin/users`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(s.ok){const r=await s.json();C(r)}else console.error("Failed to fetch users"),h.error("Failed to fetch users")}catch(s){console.error("Error fetching users:",s),h.error("Failed to fetch users")}},S=async()=>{if(!(!t?.access_token||a?.role!=="admin"))try{const s=await fetch(`https://${_}.supabase.co/functions/v1/make-server-0603cad1/admin/audit-logs`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(s.ok){const r=await s.json();T(r)}else console.error("Failed to fetch audit logs"),h.error("Failed to fetch audit logs")}catch(s){console.error("Error fetching audit logs:",s),h.error("Failed to fetch audit logs")}};i.useEffect(()=>{const s=async()=>{g(!0),await Promise.all([L(),S()]),g(!1)};a?.role==="admin"&&s()},[t,a]);const E=u.filter(s=>s.fullName.toLowerCase().includes(f.toLowerCase())||s.email.toLowerCase().includes(f.toLowerCase())),F=s=>{switch(s){case"profile_updated":return"bg-blue-100 text-blue-800";case"semester_created":case"subject_created":case"project_created":case"certificate_created":return"bg-green-100 text-green-800";case"semester_deleted":case"subject_deleted":case"project_deleted":case"certificate_deleted":return"bg-red-100 text-red-800";case"semester_updated":case"subject_updated":case"project_updated":case"certificate_updated":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},P=s=>s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),b=s=>new Date(s).toLocaleString();if(a?.role!=="admin")return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to access the admin panel."})]});if(k)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((s,r)=>e.jsx(c,{children:e.jsxs(l,{children:[e.jsx("div",{className:"h-6 w-32 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-8 w-16 bg-muted rounded"})]})},r))}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx("div",{className:"h-6 w-48 bg-muted rounded"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,r)=>e.jsx("div",{className:"h-12 bg-muted rounded"},r))})})]})]});const R=u.length,B=u.filter(s=>s.role==="admin").length,D=j.slice(0,10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:R}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registered users"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Admin Users"}),e.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:B}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Administrator accounts"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Recent Activity"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total logged actions"})]})]})]}),e.jsxs(V,{defaultValue:"users",className:"space-y-4",children:[e.jsxs(Y,{children:[e.jsx(v,{value:"users",children:"Users"}),e.jsx(v,{value:"activity",children:"Activity Logs"})]}),e.jsx(y,{value:"users",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(o,{children:"User Management"}),e.jsx(w,{children:"View and manage user accounts"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(M,{placeholder:"Search users...",value:f,onChange:s=>U(s.target.value),className:"pl-10"})]})})]}),e.jsx(d,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs(A,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Email"}),e.jsx(x,{children:"Role"}),e.jsx(x,{children:"Created"}),e.jsx(x,{children:"Public Profile"})]})}),e.jsx(Q,{children:E.map(s=>e.jsxs(A,{children:[e.jsx(m,{className:"font-medium",children:s.fullName}),e.jsx(m,{children:s.email}),e.jsx(m,{children:e.jsx(p,{variant:s.role==="admin"?"destructive":"secondary",children:s.role})}),e.jsx(m,{children:b(s.createdAt)}),e.jsx(m,{children:e.jsx(p,{variant:s.publicProfile?"default":"outline",children:s.publicProfile?"Yes":"No"})})]},s.id))})]})})})]})}),e.jsx(y,{value:"activity",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(o,{children:"Activity Logs"}),e.jsx(w,{children:"Recent user activities and system events"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[D.map((s,r)=>{const I=u.find($=>$.id===s.userId);return e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[e.jsx(p,{className:F(s.action),children:P(s.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:I?.fullName||"Unknown User"})," ",s.details]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:[e.jsx(q,{className:"h-3 w-3"}),b(s.timestamp)]})]})]},r)}),j.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No activity logs found"})]})})]})})]})]})}export{ee as AdminPanel};
