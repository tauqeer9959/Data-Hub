import{u as _,r as c,j as e,C as A,b as T,d as I,e as z,q as L,s as $,v as G,w as J,x as O,U as H,g as B,L as D,y as d,I as N,z as W,S as K,p as v,t as j}from"./index-xKifkbJu.js";import{U as Q}from"./upload-C6yA1IZy.js";function Y(){const{profile:a,session:p,refreshProfile:y}=_(),[n,b]=c.useState({fullName:a?.fullName||"",phone:a?.phone||"",location:a?.location||"",bio:a?.bio||"",publicProfile:a?.publicProfile||!1}),[t,P]=c.useState(!1),[w,C]=c.useState(!1),[k,l]=c.useState(""),[F,u]=c.useState(""),S=c.useRef(null),m=o=>{const{name:s,value:h,type:i}=o.target;b(r=>({...r,[s]:i==="checkbox"?o.target.checked:h}))},E=o=>{b(s=>({...s,publicProfile:o}))},M=async o=>{const s=o.target.files?.[0];if(!s||!p?.access_token)return;if(console.log("Profile picture upload started:",s.name,s.type,s.size),!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(s.type)){l("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}if(s.size>10485760){l("File size too large. Maximum size is 10MB.");return}C(!0),l(""),u("");try{const i=new FormData;i.append("file",s),console.log("Uploading file to server...");const r=await fetch(`https://${v}.supabase.co/functions/v1/make-server-0603cad1/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${p.access_token}`},body:i});console.log("Upload response status:",r.status);const f=await r.json();if(console.log("Upload response data:",f),!r.ok){const x=f.error||"Failed to upload profile picture";l(x),j.error(x);return}console.log("File uploaded successfully, updating profile...");const g=await fetch(`https://${v}.supabase.co/functions/v1/make-server-0603cad1/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p.access_token}`},body:JSON.stringify({profilePicture:f.signedUrl||f.url})});if(console.log("Profile update response status:",g.status),g.ok)await y(),u("Profile picture updated successfully"),j.success("Profile picture updated successfully"),console.log("Profile picture update completed");else{const x=await g.json();console.error("Profile update failed:",x);const U="Failed to update profile with new picture";l(U),j.error(U)}}catch(i){console.error("Profile picture upload error:",i);const r=`Failed to upload profile picture: ${i.message}`;l(r),j.error(r)}finally{C(!1)}},R=async o=>{o.preventDefault(),P(!0),l(""),u("");try{const s=await fetch(`https://${v}.supabase.co/functions/v1/make-server-0603cad1/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p?.access_token}`},body:JSON.stringify(n)}),h=await s.json();if(!s.ok){l(h.error||"Failed to update profile");return}await y(),u("Profile updated successfully")}catch(s){console.error("Profile update error:",s),l("Failed to update profile")}finally{P(!1)}},q=o=>o.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(I,{children:"Profile Information"})}),e.jsxs(z,{className:"space-y-6",children:[k&&e.jsx(L,{variant:"destructive",children:e.jsx($,{children:k})}),F&&e.jsx(L,{children:e.jsx($,{children:F})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(G,{className:"h-20 w-20",children:[e.jsx(J,{src:a?.profilePicture,alt:a?.fullName||""}),e.jsx(O,{className:"text-lg",children:a?.fullName?q(a.fullName):e.jsx(H,{className:"h-8 w-8"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(B,{type:"button",variant:"outline",onClick:()=>S.current?.click(),disabled:w,children:[w?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Upload Photo"]}),e.jsx("input",{ref:S,type:"file",accept:"image/*",onChange:M,className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: Square image, at least 200x200px"})]})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(N,{id:"fullName",name:"fullName",value:n.fullName,onChange:m,required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone"}),e.jsx(N,{id:"phone",name:"phone",type:"tel",value:n.phone,onChange:m,disabled:t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location",children:"Location"}),e.jsx(N,{id:"location",name:"location",value:n.location,onChange:m,placeholder:"City, Country",disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"bio",children:"Bio"}),e.jsx(W,{id:"bio",name:"bio",value:n.bio,onChange:m,placeholder:"Tell us about yourself...",rows:4,disabled:t})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{id:"publicProfile",checked:n.publicProfile,onCheckedChange:E,disabled:t}),e.jsx(d,{htmlFor:"publicProfile",children:"Make profile public"})]}),e.jsxs(B,{type:"submit",disabled:t,children:[t&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Profile"]})]})]})]}),e.jsxs(A,{children:[e.jsx(T,{children:e.jsx(I,{children:"Contact Information"})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("div",{className:"text-muted-foreground",children:a?.email})]}),a?.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("div",{className:"text-muted-foreground",children:a.phone})]}),a?.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("div",{className:"text-muted-foreground",children:a.location})]})]}),e.jsx("div",{className:"pt-4 border-t text-xs text-muted-foreground",children:"Â© 2025 Tawqeer Ahmad. All rights reserved."})]})]})]})}export{Y as ProfileForm};
