import{r as l,a1 as q,a2 as le,j as e,a3 as de,a4 as ue,a5 as fe,a6 as J,a7 as K,a8 as b,a9 as W,aa as Y,ab as pe,ac as he,ad as me,ae as xe,af as ge,ag as ve,ah as je,ai as Ce,aj as Pe,ak as V,u as Z,y as S,I as O,g as j,n as Q,p as D,t as v,C as R,b as T,e as k,D as I,E as L,H as M,J as $,K as z,M as U,A as B,d as we,o as Ne,B as ye}from"./index-xKifkbJu.js";import{C as be}from"./calendar-BObb0Gur.js";import{U as De}from"./upload-C6yA1IZy.js";import{S as Ae}from"./search-DzMNDHdN.js";import{P as H,S as Se}from"./square-pen-DwbjdNbe.js";import{T as Oe}from"./trash-2-BvwvbQeQ.js";import{E as Ee}from"./external-link-BS7R7yCb.js";var E="Popover",[X]=ue(E,[q]),A=q(),[Fe,C]=X(E),ee=t=>{const{__scopePopover:c,children:n,open:i,defaultOpen:s,onOpenChange:a,modal:r=!1}=t,d=A(c),p=l.useRef(null),[x,m]=l.useState(!1),[g,u]=le({prop:i,defaultProp:s??!1,onChange:a,caller:E});return e.jsx(de,{...d,children:e.jsx(Fe,{scope:c,contentId:fe(),triggerRef:p,open:g,onOpenChange:u,onOpenToggle:l.useCallback(()=>u(f=>!f),[u]),hasCustomAnchor:x,onCustomAnchorAdd:l.useCallback(()=>m(!0),[]),onCustomAnchorRemove:l.useCallback(()=>m(!1),[]),modal:r,children:n})})};ee.displayName=E;var te="PopoverAnchor",Re=l.forwardRef((t,c)=>{const{__scopePopover:n,...i}=t,s=C(te,n),a=A(n),{onCustomAnchorAdd:r,onCustomAnchorRemove:d}=s;return l.useEffect(()=>(r(),()=>d()),[r,d]),e.jsx(W,{...a,...i,ref:c})});Re.displayName=te;var se="PopoverTrigger",re=l.forwardRef((t,c)=>{const{__scopePopover:n,...i}=t,s=C(se,n),a=A(n),r=J(c,s.triggerRef),d=e.jsx(K.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":ce(s.open),...i,ref:r,onClick:b(t.onClick,s.onOpenToggle)});return s.hasCustomAnchor?d:e.jsx(W,{asChild:!0,...a,children:d})});re.displayName=se;var _="PopoverPortal",[ke,_e]=X(_,{forceMount:void 0}),ae=t=>{const{__scopePopover:c,forceMount:n,children:i,container:s}=t,a=C(_,c);return e.jsx(ke,{scope:c,forceMount:n,children:e.jsx(Y,{present:n||a.open,children:e.jsx(pe,{asChild:!0,container:s,children:i})})})};ae.displayName=_;var y="PopoverContent",oe=l.forwardRef((t,c)=>{const n=_e(y,t.__scopePopover),{forceMount:i=n.forceMount,...s}=t,a=C(y,t.__scopePopover);return e.jsx(Y,{present:i||a.open,children:a.modal?e.jsx(Ie,{...s,ref:c}):e.jsx(Le,{...s,ref:c})})});oe.displayName=y;var Te=xe("PopoverContent.RemoveScroll"),Ie=l.forwardRef((t,c)=>{const n=C(y,t.__scopePopover),i=l.useRef(null),s=J(c,i),a=l.useRef(!1);return l.useEffect(()=>{const r=i.current;if(r)return he(r)},[]),e.jsx(me,{as:Te,allowPinchZoom:!0,children:e.jsx(ne,{...t,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:b(t.onCloseAutoFocus,r=>{r.preventDefault(),a.current||n.triggerRef.current?.focus()}),onPointerDownOutside:b(t.onPointerDownOutside,r=>{const d=r.detail.originalEvent,p=d.button===0&&d.ctrlKey===!0,x=d.button===2||p;a.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:b(t.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1})})})}),Le=l.forwardRef((t,c)=>{const n=C(y,t.__scopePopover),i=l.useRef(!1),s=l.useRef(!1);return e.jsx(ne,{...t,ref:c,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{t.onCloseAutoFocus?.(a),a.defaultPrevented||(i.current||n.triggerRef.current?.focus(),a.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:a=>{t.onInteractOutside?.(a),a.defaultPrevented||(i.current=!0,a.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const r=a.target;n.triggerRef.current?.contains(r)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&s.current&&a.preventDefault()}})}),ne=l.forwardRef((t,c)=>{const{__scopePopover:n,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:a,disableOutsidePointerEvents:r,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:x,onInteractOutside:m,...g}=t,u=C(y,n),f=A(n);return ge(),e.jsx(ve,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:a,children:e.jsx(je,{asChild:!0,disableOutsidePointerEvents:r,onInteractOutside:m,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:x,onDismiss:()=>u.onOpenChange(!1),children:e.jsx(Ce,{"data-state":ce(u.open),role:"dialog",id:u.contentId,...f,...g,ref:c,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ie="PopoverClose",Me=l.forwardRef((t,c)=>{const{__scopePopover:n,...i}=t,s=C(ie,n);return e.jsx(K.button,{type:"button",...i,ref:c,onClick:b(t.onClick,()=>s.onOpenChange(!1))})});Me.displayName=ie;var $e="PopoverArrow",ze=l.forwardRef((t,c)=>{const{__scopePopover:n,...i}=t,s=A(n);return e.jsx(Pe,{...s,...i,ref:c})});ze.displayName=$e;function ce(t){return t?"open":"closed"}var Ue=ee,Be=re,He=ae,Ge=oe;function qe({...t}){return e.jsx(Ue,{"data-slot":"popover",...t})}function Je({...t}){return e.jsx(Be,{"data-slot":"popover-trigger",...t})}function Ke({className:t,align:c="center",sideOffset:n=4,...i}){return e.jsx(He,{children:e.jsx(Ge,{"data-slot":"popover-content",align:c,sideOffset:n,className:V("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...i})})}function G({certificate:t,onSave:c,onCancel:n}){const{session:i}=Z(),[s,a]=l.useState(!1),[r,d]=l.useState({title:"",issuer:"",issueDate:new Date,filePath:""});l.useEffect(()=>{t&&d({title:t.title,issuer:t.issuer,issueDate:new Date(t.issueDate),filePath:t.filePath||""})},[t]);const p=u=>{const{name:f,value:w}=u.target;d(h=>({...h,[f]:w}))},x=u=>{u&&d(f=>({...f,issueDate:u}))},m=async u=>{const f=u.target.files?.[0];if(!f||!i?.access_token)return;if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(f.type)){v.error("Please select a PDF or image file");return}if(f.size>10*1024*1024){v.error("File size must be less than 10MB");return}a(!0);try{const h=new FormData;h.append("file",f);const P=await fetch(`https://${D}.supabase.co/functions/v1/make-server-0603cad1/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${i.access_token}`},body:h});if(!P.ok){const o=await P.json();throw new Error(o.error||"Upload failed")}const F=await P.json();d(o=>({...o,filePath:F.file_path})),v.success("File uploaded successfully")}catch(h){console.error("Error uploading file:",h),v.error(h instanceof Error?h.message:"Failed to upload file")}finally{a(!1)}},g=async u=>{if(u.preventDefault(),!!i?.access_token){a(!0);try{const f=t?`https://${D}.supabase.co/functions/v1/make-server-0603cad1/certificates/${t.id}`:`https://${D}.supabase.co/functions/v1/make-server-0603cad1/certificates`,h=await fetch(f,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify({title:r.title,issuer:r.issuer,issueDate:r.issueDate.toISOString(),filePath:r.filePath})});if(h.ok)v.success(t?"Certificate updated successfully":"Certificate added successfully"),c();else{const P=await h.json();v.error(P.error||"Failed to save certificate")}}catch(f){console.error("Error saving certificate:",f),v.error("Failed to save certificate")}finally{a(!1)}}};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"title",children:"Certificate Title"}),e.jsx(O,{id:"title",name:"title",value:r.title,onChange:p,placeholder:"e.g., AWS Certified Solutions Architect",required:!0,disabled:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"issuer",children:"Issuing Organization"}),e.jsx(O,{id:"issuer",name:"issuer",value:r.issuer,onChange:p,placeholder:"e.g., Amazon Web Services",required:!0,disabled:s})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Issue Date"}),e.jsxs(qe,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:V("w-full justify-start text-left font-normal",!r.issueDate&&"text-muted-foreground"),disabled:s,children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),r.issueDate?r.issueDate.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Ke,{className:"w-auto p-0",children:e.jsx(be,{mode:"single",selected:r.issueDate,onSelect:x,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"certificate-file",children:"Certificate File (Optional)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{id:"certificate-file",type:"file",onChange:m,accept:".pdf,.jpg,.jpeg,.png",disabled:s,className:"hidden"}),e.jsxs(j,{type:"button",variant:"outline",onClick:()=>document.getElementById("certificate-file")?.click(),disabled:s,className:"w-full",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),r.filePath?"Change File":"Upload Certificate"]})]}),r.filePath&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Selected: ",r.filePath]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supported formats: PDF, JPG, PNG (max 10MB)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:n,disabled:s,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:s||!r.title.trim()||!r.issuer.trim(),children:s?"Saving...":t?"Update Certificate":"Add Certificate"})]})]})}function tt(){const{session:t}=Z(),[c,n]=l.useState([]),[i,s]=l.useState(!0),[a,r]=l.useState(""),[d,p]=l.useState(null),[x,m]=l.useState(!1),g=async()=>{if(t?.access_token)try{const o=await fetch(`https://${D}.supabase.co/functions/v1/make-server-0603cad1/certificates`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(o.ok){const N=await o.json();n(N)}else console.error("Failed to fetch certificates")}catch(o){console.error("Error fetching certificates:",o)}finally{s(!1)}};l.useEffect(()=>{g()},[t]);const u=async o=>{if(!(!t?.access_token||!confirm("Are you sure you want to delete this certificate?")))try{(await fetch(`https://${D}.supabase.co/functions/v1/make-server-0603cad1/certificates/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.access_token}`}})).ok?(v.success("Certificate deleted successfully"),g()):v.error("Failed to delete certificate")}catch(N){console.error("Error deleting certificate:",N),v.error("Failed to delete certificate")}},f=o=>{p(o),m(!0)},w=()=>{g(),m(!1),p(null)},h=c.filter(o=>o.title.toLowerCase().includes(a.toLowerCase())||o.issuer.toLowerCase().includes(a.toLowerCase())),P=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),F=o=>new Date(o).getFullYear();return i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((o,N)=>e.jsxs(R,{children:[e.jsxs(T,{children:[e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded"})]})]},N))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(O,{placeholder:"Search certificates...",value:a,onChange:o=>r(o.target.value),className:"pl-10"})]}),e.jsxs(I,{open:x,onOpenChange:m,children:[e.jsx(L,{asChild:!0,children:e.jsxs(j,{onClick:()=>p(null),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Certificate"]})}),e.jsxs(M,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(z,{children:d?"Edit Certificate":"Add New Certificate"}),e.jsx(U,{children:d?"Update your certificate information":"Add a new certificate to your profile"})]}),e.jsx(G,{certificate:d,onSave:w,onCancel:()=>{m(!1),p(null)}})]})]})]}),h.length===0?e.jsx(R,{children:e.jsxs(k,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(B,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("div",{className:"text-muted-foreground mb-4",children:c.length===0?"No certificates found":"No certificates match your search"}),c.length===0&&e.jsxs(I,{open:x,onOpenChange:m,children:[e.jsx(L,{asChild:!0,children:e.jsxs(j,{onClick:()=>p(null),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Add Your First Certificate"]})}),e.jsxs(M,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(z,{children:"Add New Certificate"}),e.jsx(U,{children:"Add a new certificate to your profile"})]}),e.jsx(G,{certificate:null,onSave:w,onCancel:()=>{m(!1),p(null)}})]})]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(o=>e.jsxs(R,{className:"flex flex-col",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(we,{className:"line-clamp-2 flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-yellow-500"}),o.title]}),e.jsxs(Ne,{className:"mt-2",children:["Issued by ",o.issuer]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>f(o),children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>u(o.id),className:"text-destructive hover:text-destructive",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]})}),e.jsxs(k,{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs("span",{children:["Issued on ",P(o.issueDate)]})]}),e.jsx(ye,{variant:"outline",children:F(o.issueDate)}),o.filePath&&e.jsx(j,{variant:"outline",size:"sm",asChild:!0,className:"w-full",children:e.jsxs("a",{href:o.filePath,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"View Certificate"]})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4",children:["Added ",new Date(o.createdAt).toLocaleDateString()]})]})]},o.id))})]})}export{tt as CertificateList};
