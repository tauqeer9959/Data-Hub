import{u as K,r as c,j as e,y as f,I as k,g as b,t as m,p as S,a as se,C as H,b as _,e as $,D as G,E as z,H as O,J as U,K as V,M as q,G as ae,d as re,o as te,B as M}from"./index-xKifkbJu.js";import{S as D,a as A,b as F,c as E,d as N}from"./select-DhM0P97W.js";import{E as R}from"./EducationLevelTabs-BjJvaScJ.js";import{S as le}from"./search-DzMNDHdN.js";import{P as J,S as ne}from"./square-pen-DwbjdNbe.js";import{T as ce}from"./trash-2-BvwvbQeQ.js";function Y({subject:l,semesters:y,onSave:p,onCancel:I}){const{session:u}=K(),[d,C]=c.useState(!1),[t,h]=c.useState({semesterId:"",name:"",code:"",creditHours:3,marks:0,grade:"F"});c.useEffect(()=>{l&&h({semesterId:l.semesterId,name:l.name,code:l.code,creditHours:l.creditHours,marks:l.marks,grade:l.grade})},[l]),c.useEffect(()=>{const a=r=>r>=85?"A+":r>=80?"A-":r>=75?"B+":r>=70?"B-":r>=65?"C+":r>=60?"C-":r>=55?"D+":r>=50?"D-":"F";if(t.marks!==null){const r=a(t.marks);r!==t.grade&&h(i=>({...i,grade:r}))}},[t.marks]);const v=a=>{const{name:r,value:i}=a.target;h(o=>({...o,[r]:r==="creditHours"||r==="marks"?parseFloat(i)||0:i}))},x=(a,r)=>{h(i=>({...i,[a]:a==="creditHours"?parseInt(r):r}))},B=async a=>{if(a.preventDefault(),!!u?.access_token){if(!t.semesterId){m.error("Please select a semester");return}if(t.marks<0||t.marks>100){m.error("Marks must be between 0 and 100");return}if(t.creditHours<1||t.creditHours>6){m.error("Credit hours must be between 1 and 6");return}C(!0);try{const r=l?`https://${S}.supabase.co/functions/v1/make-server-0603cad1/subjects/${l.id}`:`https://${S}.supabase.co/functions/v1/make-server-0603cad1/subjects`,o=await fetch(r,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u.access_token}`},body:JSON.stringify(t)});if(o.ok)m.success(l?"Subject updated successfully":"Subject created successfully"),p();else{const j=await o.json();m.error(j.error||"Failed to save subject")}}catch(r){console.error("Error saving subject:",r),m.error("Failed to save subject")}finally{C(!1)}}};return e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"semesterId",children:"Semester"}),e.jsxs(D,{value:t.semesterId,onValueChange:a=>x("semesterId",a),disabled:d,children:[e.jsx(A,{children:e.jsx(F,{placeholder:"Select a semester"})}),e.jsx(E,{children:y.map(a=>e.jsxs(N,{value:a.id,children:["Semester ",a.semesterNo," (",a.year,")"]},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"name",children:"Subject Name"}),e.jsx(k,{id:"name",name:"name",value:t.name,onChange:v,placeholder:"e.g., Data Structures",required:!0,disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"code",children:"Subject Code"}),e.jsx(k,{id:"code",name:"code",value:t.code,onChange:v,placeholder:"e.g., CS201",required:!0,disabled:d})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"creditHours",children:"Credit Hours"}),e.jsxs(D,{value:t.creditHours.toString(),onValueChange:a=>x("creditHours",a),disabled:d,children:[e.jsx(A,{children:e.jsx(F,{})}),e.jsx(E,{children:[1,2,3,4,5,6].map(a=>e.jsxs(N,{value:a.toString(),children:[a," ",a===1?"hour":"hours"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"marks",children:"Marks (%)"}),e.jsx(k,{id:"marks",name:"marks",type:"number",value:t.marks,onChange:v,placeholder:"0-100",min:"0",max:"100",required:!0,disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"grade",children:"Grade"}),e.jsxs(D,{value:t.grade,onValueChange:a=>x("grade",a),disabled:d,children:[e.jsx(A,{children:e.jsx(F,{})}),e.jsx(E,{children:[{value:"A+",label:"A+ (85-100)"},{value:"A-",label:"A- (80-85)"},{value:"B+",label:"B+ (75-80)"},{value:"B-",label:"B- (70-75)"},{value:"C+",label:"C+ (65-70)"},{value:"C-",label:"C- (60-65)"},{value:"D+",label:"D+ (55-60)"},{value:"D-",label:"D- (50-55)"},{value:"F",label:"F (<50)"}].map(a=>e.jsx(N,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:I,disabled:d,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:d||!t.name.trim()||!t.code.trim()||!t.semesterId,children:d?"Saving...":l?"Update Subject":"Create Subject"})]})]})}function xe(){const{session:l}=K(),{currentLevel:y}=se(),[p,I]=c.useState([]),[u,d]=c.useState([]),[C,t]=c.useState(!0),[h,v]=c.useState(""),[x,B]=c.useState("all"),[a,r]=c.useState(null),[i,o]=c.useState(!1),j=async()=>{if(l?.access_token)try{const s=await fetch(`https://${S}.supabase.co/functions/v1/make-server-0603cad1/semesters?educationLevel=${y}`,{headers:{Authorization:`Bearer ${l.access_token}`}});let n=[];s.ok&&(n=await s.json(),d(n));const g=[];for(const P of n)try{const w=await fetch(`https://${S}.supabase.co/functions/v1/make-server-0603cad1/semesters/${P.id}/subjects`,{headers:{Authorization:`Bearer ${l.access_token}`}});if(w.ok){const ee=await w.json();g.push(...ee)}}catch(w){console.error(`Error fetching subjects for semester ${P.id}:`,w)}I(g)}catch(s){console.error("Error fetching data:",s)}finally{t(!1)}};c.useEffect(()=>{j()},[l,y]);const Q=async s=>{if(!(!l?.access_token||!confirm("Are you sure you want to delete this subject?")))try{(await fetch(`https://${S}.supabase.co/functions/v1/make-server-0603cad1/subjects/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${l.access_token}`}})).ok?(m.success("Subject deleted successfully"),j()):m.error("Failed to delete subject")}catch(n){console.error("Error deleting subject:",n),m.error("Failed to delete subject")}},W=s=>{r(s),o(!0)},L=()=>{j(),o(!1),r(null)},X=s=>{const n=u.find(g=>g.id===s);return n?`Semester ${n.semesterNo} (${n.year})`:"Unknown Semester"},Z=s=>({"A+":"text-green-700 bg-green-100",A:"text-green-700 bg-green-100","A-":"text-green-600 bg-green-50","B+":"text-blue-700 bg-blue-100",B:"text-blue-600 bg-blue-50","B-":"text-blue-500 bg-blue-50","C+":"text-yellow-700 bg-yellow-100",C:"text-yellow-600 bg-yellow-50","C-":"text-yellow-500 bg-yellow-50","D+":"text-orange-700 bg-orange-100",D:"text-orange-600 bg-orange-50",F:"text-red-700 bg-red-100"})[s]||"text-gray-600 bg-gray-50",T=p.filter(s=>{const n=s.name.toLowerCase().includes(h.toLowerCase())||s.code.toLowerCase().includes(h.toLowerCase()),g=x==="all"||s.semesterId===x;return n&&g});return C?e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{onDataCleared:j}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,n)=>e.jsxs(H,{children:[e.jsxs(_,{children:[e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]}),e.jsxs($,{children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded"})]})]},n))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{onDataCleared:j}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(k,{placeholder:"Search subjects...",value:h,onChange:s=>v(s.target.value),className:"pl-10"})]}),e.jsxs(D,{value:x,onValueChange:B,children:[e.jsx(A,{className:"w-48",children:e.jsx(F,{placeholder:"Filter by semester"})}),e.jsxs(E,{children:[e.jsx(N,{value:"all",children:"All Semesters"}),u.map(s=>e.jsxs(N,{value:s.id,children:["Semester ",s.semesterNo," (",s.year,")"]},s.id))]})]})]}),e.jsxs(G,{open:i,onOpenChange:o,children:[e.jsx(z,{asChild:!0,children:e.jsxs(b,{onClick:()=>r(null),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add Subject"]})}),e.jsxs(O,{children:[e.jsxs(U,{children:[e.jsx(V,{children:a?"Edit Subject":"Add New Subject"}),e.jsx(q,{children:a?"Update subject information and grades":"Add a new subject to track your academic performance"})]}),e.jsx(Y,{subject:a,semesters:u,onSave:L,onCancel:()=>{o(!1),r(null)}})]})]})]}),T.length===0?e.jsx(H,{children:e.jsxs($,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("div",{className:"text-muted-foreground mb-4",children:p.length===0?"No subjects found":"No subjects match your search"}),p.length===0&&u.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"You need to create a semester first before adding subjects."}),u.length>0&&e.jsxs(G,{open:i,onOpenChange:o,children:[e.jsx(z,{asChild:!0,children:e.jsxs(b,{onClick:()=>r(null),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add Your First Subject"]})}),e.jsxs(O,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Add New Subject"}),e.jsx(q,{children:"Add a new subject to track your academic performance"})]}),e.jsx(Y,{subject:null,semesters:u,onSave:L,onCancel:()=>{o(!1),r(null)}})]})]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(s=>e.jsxs(H,{className:"flex flex-col",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(re,{className:"line-clamp-2",children:s.name}),e.jsxs(te,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-mono text-sm",children:s.code}),e.jsx("span",{className:"text-xs",children:X(s.semesterId)})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>W(s),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Q(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(ce,{className:"h-4 w-4"})})]})]})}),e.jsxs($,{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Credit Hours"}),e.jsx(M,{variant:"outline",children:s.creditHours})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Marks"}),e.jsxs("span",{className:"font-medium",children:[s.marks,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grade"}),e.jsx(M,{variant:"secondary",className:Z(s.grade),children:s.grade})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4",children:["Updated ",new Date(s.updatedAt).toLocaleDateString()]})]})]},s.id))})]})}export{xe as SubjectList};
