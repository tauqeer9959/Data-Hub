import{t as u,u as ie,a as de,r as v,j as e,C as d,b as h,e as m,g as P,R as X,d as x,T as he,B as N,h as me,A as W,i as xe,k as je,l as k,m as D,n as ge,p as A}from"./index-xKifkbJu.js";import{P as ue}from"./progress-BvI071EH.js";import{g as pe,T as fe,R as w,L as be,C as L,X as B,Y as E,a as C,b as ye,c as ve,P as Ne,d as we,e as Ce,f as Se,h as ke,i as De,j as Ae,B as $e,k as Re,A as Te,l as Pe}from"./gpaCalculator-BUvHCusu.js";import{CacheKeys as q,dashboardCache as F}from"./caching-C5wynY3z.js";import{D as Le}from"./download-CjHMZWAk.js";import{T as Be}from"./trending-up-Deg-G1dY.js";class Ee{static async exportToJSON(r){try{const a=JSON.stringify(r,null,2),t=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download=`data-hub-export-${r.educationLevel}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),u.success("Data exported successfully")}catch(a){console.error("Export error:",a),u.error("Failed to export data")}}static async exportToCSV(r){try{const a=this.convertToCSV(r),t=new Blob([a],{type:"text/csv"}),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download=`data-hub-export-${r.educationLevel}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),u.success("Data exported to CSV successfully")}catch(a){console.error("CSV export error:",a),u.error("Failed to export to CSV")}}static async exportToPDF(r){try{const a=this.generatePDFContent(r),t=`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Academic Report - ${r.user.fullName}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; margin-bottom: 30px; }
            .section { margin-bottom: 20px; }
            .table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .table th { background-color: #f2f2f2; }
            .grade-a { color: green; font-weight: bold; }
            .grade-b { color: blue; font-weight: bold; }
            .grade-c { color: orange; font-weight: bold; }
            .grade-d { color: red; font-weight: bold; }
          </style>
        </head>
        <body>
          ${a}
        </body>
        </html>
      `,i=new Blob([t],{type:"text/html"}),l=URL.createObjectURL(i),p=document.createElement("a");p.href=l,p.download=`academic-report-${r.educationLevel}-${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(l),u.success("Academic report generated successfully")}catch(a){console.error("PDF export error:",a),u.error("Failed to generate report")}}static convertToCSV(r){const a=r.subjects||[];return a.length===0?"No data available":[["Subject Name","Semester","Marks","Credit Hours","Grade","Grade Points"].join(","),...a.map(l=>[`"${l.name||""}"`,`"${l.semester||""}"`,l.marks||0,l.creditHours||0,`"${l.grade||""}"`,l.gradePoints||0].join(","))].join(`
`)}static generatePDFContent(r){return`
      <div class="header">
        <h1>Academic Report</h1>
        <h2>${r.user.fullName}</h2>
        <p>Education Level: ${r.educationLevel}</p>
        <p>Report Generated: ${new Date().toLocaleDateString()}</p>
      </div>

      <div class="section">
        <h3>Summary</h3>
        <p>Total Semesters: ${r.semesters?.length||0}</p>
        <p>Total Subjects: ${r.subjects?.length||0}</p>
        <p>Total Projects: ${r.projects?.length||0}</p>
        <p>Total Certificates: ${r.certificates?.length||0}</p>
      </div>

      <div class="section">
        <h3>Subjects</h3>
        <table class="table">
          <thead>
            <tr>
              <th>Subject</th>
              <th>Semester</th>
              <th>Marks</th>
              <th>Credit Hours</th>
              <th>Grade</th>
            </tr>
          </thead>
          <tbody>
            ${r.subjects?.map(a=>`
              <tr>
                <td>${a.name||"N/A"}</td>
                <td>${a.semester||"N/A"}</td>
                <td>${a.marks||0}</td>
                <td>${a.creditHours||0}</td>
                <td class="grade-${a.grade?.charAt(0).toLowerCase()||"f"}">${a.grade||"N/A"}</td>
              </tr>
            `).join("")||'<tr><td colspan="5">No subjects found</td></tr>'}
          </tbody>
        </table>
      </div>
    `}}function Fe(j,r,a,t,i,l){return{user:{id:j.id,email:j.email,fullName:j.fullName||j.email?.split("@")[0]||"User"},exportDate:new Date().toISOString(),educationLevel:l,semesters:r||[],subjects:a||[],projects:t||[],certificates:i||[],metadata:{version:"1.0.0",totalRecords:(r?.length||0)+(a?.length||0)+(t?.length||0)+(i?.length||0)}}}const Q=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"];function ze(){const{user:j,session:r}=ie(),{currentLevel:a}=de(),[t,i]=v.useState(null),[l,p]=v.useState(!0),[O,G]=v.useState(!1),[Oe,Ge]=v.useState("all"),U=async(n=!0)=>{if(!r?.access_token||!j)return;const o=q.dashboardStats(j.id,a);if(n){const b=F.get(o);if(b){i(b),p(!1);return}}try{G(!l);const[b,I,V]=await Promise.all([fetch(`https://${A}.supabase.co/functions/v1/make-server-0603cad1/semesters?educationLevel=${a}`,{headers:{Authorization:`Bearer ${r.access_token}`}}),fetch(`https://${A}.supabase.co/functions/v1/make-server-0603cad1/projects`,{headers:{Authorization:`Bearer ${r.access_token}`}}),fetch(`https://${A}.supabase.co/functions/v1/make-server-0603cad1/certificates`,{headers:{Authorization:`Bearer ${r.access_token}`}})]),g=b.ok?await b.json():[],_=I.ok?await I.json():[],z=V.ok?await V.json():[],f=[];for(const s of g)try{const c=await fetch(`https://${A}.supabase.co/functions/v1/make-server-0603cad1/semesters/${s.id}/subjects`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(c.ok){const T=await c.json();f.push(...T)}}catch(c){console.error(`Error fetching subjects for semester ${s.id}:`,c)}const ee=g.length,y=f.length,se=_.length,te=z.length;let H=0;if(g.length>0){const s=g.filter(c=>c.gpa!=null&&!isNaN(c.gpa));s.length>0&&(H=s.reduce((c,T)=>c+T.gpa,0)/s.length)}const ae=f.filter(s=>s.grade&&s.grade!=="F"&&s.grade!=="").length,re=y>0?ae/y*100:0,$={};f.forEach(s=>{s.grade&&s.grade.trim()!==""&&($[s.grade]=($[s.grade]||0)+1)});const ce=Object.entries($).map(([s,c])=>({grade:s,count:c,percentage:y>0?Math.round(c/y*100*10)/10:0})),le=g.map(s=>({semester:`Semester ${s.semesterNo} (${s.year})`,gpa:s.gpa,subjects:f.filter(c=>c.semesterId===s.id).length})),S=[..._.slice(0,3).map(s=>({type:"project",title:s.title,date:s.createdAt})),...z.slice(0,3).map(s=>({type:"certificate",title:s.title,date:s.createdAt}))].sort((s,c)=>new Date(c.date).getTime()-new Date(s.date).getTime()).slice(0,5);if(S.length<3){const s=f.filter(c=>c.grade&&(c.grade==="A+"||c.grade==="A-")).slice(0,3-S.length).map(c=>({type:"grade",title:`${c.name} - ${c.grade}`,date:c.updatedAt}));S.push(...s)}const R={"A+":4,"A-":3.7,"B+":3.3,"B-":3,"C+":2.7,"C-":2.3,"D+":2,"D-":1.7,F:0},ne=f.filter(s=>s.grade&&R[s.grade]>=3.3).map(s=>s.name).slice(0,5),oe=f.filter(s=>s.grade&&R[s.grade]&&R[s.grade]<2.7).map(s=>s.name).slice(0,5);let J="stable";if(g.length>=2){const s=g.slice(-2),c=s[1].gpa-s[0].gpa;J=c>.1?"up":c<-.1?"down":"stable"}const Y={stats:{totalSemesters:ee,totalSubjects:y,totalProjects:se,totalCertificates:te,overallGPA:H,completionRate:re},gradeDistribution:ce,semesterProgress:le,recentAchievements:S,upcomingDeadlines:[],performanceMetrics:{improvement:g.length>=2?g[g.length-1].gpa-g[0].gpa:0,trend:J,strongSubjects:ne,weakSubjects:oe}};i(Y),F.set(o,Y)}catch(b){console.error("Error fetching dashboard data:",b),u.error("Failed to load dashboard data")}finally{p(!1),G(!1)}};v.useEffect(()=>{U()},[r?.access_token,a]);const K=async()=>{const n=q.dashboardStats(j.id,a);F.delete(n),await U(!1),u.success("Dashboard data refreshed successfully")},Z=async()=>{if(!(!t||!j))try{const n=Fe(j,[],[],[],[],a);await Ee.exportToJSON(n)}catch{u.error("Failed to export data")}},M=t?pe(t.stats.overallGPA):null;return l?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((n,o)=>e.jsxs(d,{className:"animate-pulse",children:[e.jsx(h,{className:"space-y-0 pb-2",children:e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),e.jsxs(m,{children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full"})]})]},o))})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Enhanced Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive analytics and insights for your academic journey"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:K,disabled:O,children:[e.jsx(X,{className:`h-4 w-4 mr-2 ${O?"animate-spin":""}`}),"Refresh"]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:Z,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm",children:"Overall GPA"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.stats.overallGPA.toFixed(2)}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(N,{variant:"secondary",className:M?.color,children:M?.level}),t.performanceMetrics.trend==="up"&&e.jsx(Be,{className:"h-4 w-4 text-green-500 ml-2"}),t.performanceMetrics.trend==="down"&&e.jsx(fe,{className:"h-4 w-4 text-red-500 ml-2"})]})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm",children:"Completion Rate"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.stats.completionRate,"%"]}),e.jsx(ue,{value:t.stats.completionRate,className:"mt-2"})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm",children:"Total Subjects"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.stats.totalSubjects}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Across ",t.stats.totalSemesters," semesters"]})]})]}),e.jsxs(d,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm",children:"Achievement Score"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.stats.totalProjects+t.stats.totalCertificates}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Projects & Certificates"})]})]})]}),e.jsxs(xe,{defaultValue:"performance",className:"space-y-4",children:[e.jsxs(je,{children:[e.jsx(k,{value:"performance",children:"Performance"}),e.jsx(k,{value:"distribution",children:"Grades"}),e.jsx(k,{value:"progress",children:"Progress"}),e.jsx(k,{value:"insights",children:"Insights"})]}),e.jsx(D,{value:"performance",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"GPA Trend"})}),e.jsx(m,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(be,{data:t.semesterProgress,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"semester"}),e.jsx(E,{domain:[0,4]}),e.jsx(C,{}),e.jsx(ye,{type:"monotone",dataKey:"gpa",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"}})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Performance Radar"})}),e.jsx(m,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(ve,{data:[{subject:"Technical Skills",value:85},{subject:"Problem Solving",value:90},{subject:"Communication",value:75},{subject:"Teamwork",value:80},{subject:"Time Management",value:70},{subject:"Leadership",value:65}],children:[e.jsx(Ne,{}),e.jsx(we,{dataKey:"subject"}),e.jsx(Ce,{angle:90,domain:[0,100]}),e.jsx(Se,{name:"Skills",dataKey:"value",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.6}),e.jsx(C,{})]})})})]})]})}),e.jsx(D,{value:"distribution",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Grade Distribution"})}),e.jsx(m,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(ke,{children:[e.jsx(De,{data:t.gradeDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({grade:n,percentage:o})=>`${n} (${o}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:t.gradeDistribution.map((n,o)=>e.jsx(Ae,{fill:Q[o%Q.length]},`cell-${o}`))}),e.jsx(C,{})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Grade Breakdown"})}),e.jsx(m,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs($e,{data:t.gradeDistribution,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"grade"}),e.jsx(E,{}),e.jsx(C,{}),e.jsx(Re,{dataKey:"count",fill:"#8884d8"})]})})})]})]})}),e.jsx(D,{value:"progress",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Semester Progress"})}),e.jsx(m,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(Te,{data:t.semesterProgress,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"semester"}),e.jsx(E,{}),e.jsx(C,{}),e.jsx(Pe,{type:"monotone",dataKey:"subjects",stackId:"1",stroke:"#8884d8",fill:"#8884d8"})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Academic Milestones"})}),e.jsx(m,{className:"space-y-4",children:t.recentAchievements.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.type})]}),e.jsx(N,{variant:"outline",children:new Date(n.date).toLocaleDateString()})]},o))})]})]})}),e.jsxs(D,{value:"insights",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Strong Areas"})}),e.jsx(m,{className:"space-y-2",children:t.performanceMetrics.strongSubjects.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 dark:bg-green-950 rounded",children:[e.jsx("span",{children:n}),e.jsx(N,{variant:"secondary",className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100",children:"Strong"})]},o))})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Areas for Improvement"})}),e.jsx(m,{className:"space-y-2",children:t.performanceMetrics.weakSubjects.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-yellow-50 dark:bg-yellow-950 rounded",children:[e.jsx("span",{children:n}),e.jsx(N,{variant:"secondary",className:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-100",children:"Focus"})]},o))})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Upcoming Deadlines"})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:t.upcomingDeadlines.map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.type})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:n.priority==="high"?"destructive":n.priority==="medium"?"default":"secondary",children:n.priority}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(n.date).toLocaleDateString()})]})]},o))})})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"Unable to load dashboard data"}),e.jsxs(P,{onClick:K,className:"mt-4",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Retry"]})]})}export{ze as EnhancedDashboard};
