import{u as z,a as G,r as l,j as e,y as D,I as U,g as j,t as d,p as b,C as w,b as k,e as C,D as A,E,H as T,J as L,K as F,M as B,f as $,d as q,o as J,B as P}from"./index-xKifkbJu.js";import{S as V,a as K,b as M,c as R,d as Q}from"./select-DhM0P97W.js";import{E as I}from"./EducationLevelTabs-BjJvaScJ.js";import{S as W}from"./search-DzMNDHdN.js";import{P as O,S as X}from"./square-pen-DwbjdNbe.js";import{T as Z}from"./trash-2-BvwvbQeQ.js";import{T as ee}from"./trending-up-Deg-G1dY.js";function _({semester:r,onSave:v,onCancel:g}){const{session:N}=z(),{currentLevel:h}=G(),[m,x]=l.useState(!1),[a,c]=l.useState({semesterNo:1,year:new Date().getFullYear(),educationLevel:h});l.useEffect(()=>{c(r?{semesterNo:r.semesterNo,year:r.year,educationLevel:r.educationLevel||h}:t=>({...t,educationLevel:h}))},[r,h]);const o=t=>{const{name:n,value:p}=t.target;c(u=>({...u,[n]:n==="semesterNo"||n==="year"?parseInt(p)||0:p}))},y=t=>{c(n=>({...n,semesterNo:parseInt(t)}))},i=async t=>{if(t.preventDefault(),!!N?.access_token){if(a.semesterNo<1||a.semesterNo>8){d.error("Semester number must be between 1 and 8");return}if(a.year<2e3||a.year>2030){d.error("Please enter a valid year");return}x(!0);try{const n=r?`https://${b}.supabase.co/functions/v1/make-server-0603cad1/semesters/${r.id}`:`https://${b}.supabase.co/functions/v1/make-server-0603cad1/semesters`,u=await fetch(n,{method:r?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${N.access_token}`},body:JSON.stringify(a)});if(u.ok)d.success(r?"Semester updated successfully":"Semester created successfully"),v();else{const S=await u.json();d.error(S.error||"Failed to save semester")}}catch(n){console.error("Error saving semester:",n),d.error("Failed to save semester")}finally{x(!1)}}};return e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"semesterNo",children:"Semester Number"}),e.jsxs(V,{value:a.semesterNo.toString(),onValueChange:y,disabled:m,children:[e.jsx(K,{children:e.jsx(M,{placeholder:"Select semester"})}),e.jsx(R,{children:[1,2,3,4,5,6,7,8].map(t=>e.jsxs(Q,{value:t.toString(),children:["Semester ",t]},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"year",children:"Academic Year"}),e.jsx(U,{id:"year",name:"year",type:"number",value:a.year,onChange:o,placeholder:"e.g., 2024",min:"2000",max:"2030",required:!0,disabled:m})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:g,disabled:m,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:m||a.semesterNo<1||a.year<2e3,children:m?"Saving...":r?"Update Semester":"Create Semester"})]})]})}function oe(){const{session:r}=z(),{currentLevel:v}=G(),[g,N]=l.useState([]),[h,m]=l.useState(!0),[x,a]=l.useState(""),[c,o]=l.useState(null),[y,i]=l.useState(!1),t=async()=>{if(r?.access_token)try{const s=await fetch(`https://${b}.supabase.co/functions/v1/make-server-0603cad1/semesters?educationLevel=${v}`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(s.ok){const f=await s.json();N(f)}else console.error("Failed to fetch semesters")}catch(s){console.error("Error fetching semesters:",s)}finally{m(!1)}};l.useEffect(()=>{t()},[r,v]);const n=async s=>{if(!(!r?.access_token||!confirm("Are you sure you want to delete this semester? This will also delete all associated subjects.")))try{(await fetch(`https://${b}.supabase.co/functions/v1/make-server-0603cad1/semesters/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.access_token}`}})).ok?(d.success("Semester deleted successfully"),t()):d.error("Failed to delete semester")}catch(f){console.error("Error deleting semester:",f),d.error("Failed to delete semester")}},p=s=>{o(s),i(!0)},u=()=>{t(),i(!1),o(null)},S=g.filter(s=>s.semesterNo.toString().includes(x)||s.year.toString().includes(x)),Y=s=>s>=3.5?"text-green-600 bg-green-50":s>=3?"text-yellow-600 bg-yellow-50":s>=2.5?"text-orange-600 bg-orange-50":"text-red-600 bg-red-50",H=s=>s>=3.7?"A":s>=3.3?"B+":s>=3?"B":s>=2.7?"C+":s>=2.3?"C":s>=2?"D":"F";return h?e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{onDataCleared:t}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,f)=>e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded"})]})]},f))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{onDataCleared:t}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(U,{placeholder:"Search semesters...",value:x,onChange:s=>a(s.target.value),className:"pl-10"})]}),e.jsxs(A,{open:y,onOpenChange:i,children:[e.jsx(E,{asChild:!0,children:e.jsxs(j,{onClick:()=>o(null),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Add Semester"]})}),e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(F,{children:c?"Edit Semester":"Add New Semester"}),e.jsx(B,{children:c?"Update semester information":"Add a new semester to track your academic progress"})]}),e.jsx(_,{semester:c,onSave:u,onCancel:()=>{i(!1),o(null)}})]})]})]}),S.length===0?e.jsx(w,{children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx($,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("div",{className:"text-muted-foreground mb-4",children:g.length===0?"No semesters found":"No semesters match your search"}),g.length===0&&e.jsxs(A,{open:y,onOpenChange:i,children:[e.jsx(E,{asChild:!0,children:e.jsxs(j,{onClick:()=>o(null),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Add Your First Semester"]})}),e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(F,{children:"Add New Semester"}),e.jsx(B,{children:"Add a new semester to track your academic progress"})]}),e.jsx(_,{semester:null,onSave:u,onCancel:()=>{i(!1),o(null)}})]})]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(s=>e.jsxs(w,{className:"flex flex-col",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Semester ",s.semesterNo]}),e.jsxs(J,{children:["Academic Year ",s.year]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>p(s),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>n(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})}),e.jsxs(C,{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"GPA"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:"secondary",className:Y(s.gpa),children:s.gpa.toFixed(2)}),e.jsx(P,{variant:"outline",children:H(s.gpa)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Credits"}),e.jsx("span",{className:"font-medium",children:s.totalCredits})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:s.gpa>=3.5?"Excellent":s.gpa>=3?"Good":s.gpa>=2.5?"Average":"Below Average"})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4",children:["Updated ",new Date(s.updatedAt).toLocaleDateString()]})]})]},s.id))})]})}export{oe as SemesterList};
