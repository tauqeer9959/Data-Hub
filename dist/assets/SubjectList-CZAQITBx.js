import{u as W,r as o,j as e,z as c,I as f,i as te,k as re,l as L,m as q,s as le,O as ne,v as ie,g as b,t as g,p as y,a as de,C as T,b as G,e as I,E as P,H as _,J as O,K as V,M as U,N as Q,G as ce,d as oe,o as me,B as R}from"./index-DwFtUS-7.js";import{S as E,a as z,b as D,c as F,d as C}from"./select-BaWgPczu.js";import{c as ue}from"./gpaCalculator-BA9QW0xm.js";import{E as J}from"./EducationLevelTabs-DAvuhMIm.js";import{S as xe}from"./search-D5XOss3u.js";import{P as Y}from"./plus-BPUQF-qH.js";import{S as he}from"./square-pen-Dt97TDIR.js";import{T as je}from"./trash-2-DR-DX5in.js";function K({subject:r,semesters:S,onSave:N,onCancel:A}){const{session:u}=W(),[i,w]=o.useState(!1),[a,x]=o.useState({semesterId:"",name:"",code:"",creditHours:3,marks:0,grade:"F",assignment:0,quizzes:0,midExam:0,finalExam:0,totalMarks:0,useComponents:!0});o.useEffect(()=>{r&&x({semesterId:r.semesterId,name:r.name,code:r.code,creditHours:r.creditHours,marks:r.marks,grade:r.grade,assignment:r.assignment||0,quizzes:r.quizzes||0,midExam:r.midExam||0,finalExam:r.finalExam||0,totalMarks:r.totalMarks||r.marks||0,useComponents:r.useComponents!==void 0?r.useComponents:!1})},[r]),o.useEffect(()=>{const t=n=>n>=85?"A+":n>=80?"A-":n>=75?"B+":n>=70?"B-":n>=65?"C+":n>=60?"C-":n>=55?"D+":n>=50?"D-":"F";let l=0;a.useComponents?l=ue(a.assignment,a.quizzes,a.midExam,a.finalExam):l=a.totalMarks;const m=t(l);(l!==a.marks||m!==a.grade)&&x(n=>({...n,marks:l,grade:m}))},[a.assignment,a.quizzes,a.midExam,a.finalExam,a.totalMarks,a.useComponents]);const h=t=>{const{name:l,value:m}=t.target,n=["creditHours","marks","assignment","quizzes","midExam","finalExam","totalMarks"];x(j=>({...j,[l]:n.includes(l)?parseFloat(m)||0:m}))},p=(t,l)=>{x(m=>({...m,[t]:t==="creditHours"?parseInt(l):l}))},M=async t=>{if(t.preventDefault(),!!u?.access_token){if(!a.semesterId){g.error("Please select a semester");return}if(a.marks<0||a.marks>100){g.error("Marks must be between 0 and 100");return}if(a.creditHours<1||a.creditHours>6){g.error("Credit hours must be between 1 and 6");return}w(!0);try{const l=r?`https://${y}.supabase.co/functions/v1/make-server-0603cad1/subjects/${r.id}`:`https://${y}.supabase.co/functions/v1/make-server-0603cad1/subjects`,n=await fetch(l,{method:r?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u.access_token}`},body:JSON.stringify(a)});if(n.ok)g.success(r?"Subject updated successfully":"Subject created successfully"),N();else{const j=await n.json();g.error(j.error||"Failed to save subject")}}catch(l){console.error("Error saving subject:",l),g.error("Failed to save subject")}finally{w(!1)}}};return e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"semesterId",children:"Semester"}),e.jsxs(E,{value:a.semesterId,onValueChange:t=>p("semesterId",t),disabled:i,children:[e.jsx(z,{children:e.jsx(D,{placeholder:"Select a semester"})}),e.jsx(F,{children:S.map(t=>e.jsxs(C,{value:t.id,children:["Semester ",t.semesterNo," (",t.year,")"]},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Subject Name"}),e.jsx(f,{id:"name",name:"name",value:a.name,onChange:h,placeholder:"e.g., Data Structures",required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"code",children:"Subject Code"}),e.jsx(f,{id:"code",name:"code",value:a.code,onChange:h,placeholder:"e.g., CS201",required:!0,disabled:i})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"creditHours",children:"Credit Hours"}),e.jsxs(E,{value:a.creditHours.toString(),onValueChange:t=>p("creditHours",t),disabled:i,children:[e.jsx(z,{children:e.jsx(D,{})}),e.jsx(F,{children:[1,2,3,4,5,6].map(t=>e.jsxs(C,{value:t.toString(),children:[t," ",t===1?"hour":"hours"]},t))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{children:"Grading Method"}),e.jsxs(te,{value:a.useComponents?"components":"total",onValueChange:t=>x({...a,useComponents:t==="components"}),children:[e.jsxs(re,{className:"grid w-full grid-cols-2",children:[e.jsx(L,{value:"components",children:"Component Marks"}),e.jsx(L,{value:"total",children:"Total Marks"})]}),e.jsxs(q,{value:"components",className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(ie,{children:"Assignment (10%), Quizzes (15%), Mid Exam (25%), Final Exam (50%)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"assignment",children:"Assignment (10%)"}),e.jsx(f,{id:"assignment",name:"assignment",type:"number",min:"0",max:"100",value:a.assignment,onChange:h,placeholder:"0-100",disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"quizzes",children:"Quizzes (15%)"}),e.jsx(f,{id:"quizzes",name:"quizzes",type:"number",min:"0",max:"100",value:a.quizzes,onChange:h,placeholder:"0-100",disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"midExam",children:"Mid Exam (25%)"}),e.jsx(f,{id:"midExam",name:"midExam",type:"number",min:"0",max:"100",value:a.midExam,onChange:h,placeholder:"0-100",disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"finalExam",children:"Final Exam (50%)"}),e.jsx(f,{id:"finalExam",name:"finalExam",type:"number",min:"0",max:"100",value:a.finalExam,onChange:h,placeholder:"0-100",disabled:i})]})]})]}),e.jsx(q,{value:"total",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"totalMarks",children:"Total Marks (%)"}),e.jsx(f,{id:"totalMarks",name:"totalMarks",type:"number",min:"0",max:"100",value:a.totalMarks,onChange:h,placeholder:"0-100",disabled:i})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Calculated Marks"}),e.jsxs("div",{className:"text-2xl font-bold",children:[a.marks.toFixed(2),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"grade",children:"Grade"}),e.jsxs(E,{value:a.grade,onValueChange:t=>p("grade",t),disabled:i,children:[e.jsx(z,{children:e.jsx(D,{})}),e.jsx(F,{children:[{value:"A+",label:"A+ (85-100)"},{value:"A-",label:"A- (80-85)"},{value:"B+",label:"B+ (75-80)"},{value:"B-",label:"B- (70-75)"},{value:"C+",label:"C+ (65-70)"},{value:"C-",label:"C- (60-65)"},{value:"D+",label:"D+ (55-60)"},{value:"D-",label:"D- (50-55)"},{value:"F",label:"F (<50)"}].map(t=>e.jsx(C,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:A,disabled:i,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:i||!a.name.trim()||!a.code.trim()||!a.semesterId,children:i?"Saving...":r?"Update Subject":"Create Subject"})]})]})}function Se(){const{session:r}=W(),{currentLevel:S}=de(),[N,A]=o.useState([]),[u,i]=o.useState([]),[w,a]=o.useState(!0),[x,h]=o.useState(""),[p,M]=o.useState("all"),[t,l]=o.useState(null),[m,n]=o.useState(!1),j=async()=>{if(r?.access_token)try{const s=await fetch(`https://${y}.supabase.co/functions/v1/make-server-0603cad1/semesters?educationLevel=${S}`,{headers:{Authorization:`Bearer ${r.access_token}`}});let d=[];s.ok&&(d=await s.json(),i(d));const v=[];for(const $ of d)try{const k=await fetch(`https://${y}.supabase.co/functions/v1/make-server-0603cad1/semesters/${$.id}/subjects`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(k.ok){const ae=await k.json();v.push(...ae)}}catch(k){console.error(`Error fetching subjects for semester ${$.id}:`,k)}A(v)}catch(s){console.error("Error fetching data:",s)}finally{a(!1)}};o.useEffect(()=>{j()},[r,S]);const X=async s=>{if(!(!r?.access_token||!confirm("Are you sure you want to delete this subject?")))try{(await fetch(`https://${y}.supabase.co/functions/v1/make-server-0603cad1/subjects/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.access_token}`}})).ok?(g.success("Subject deleted successfully"),j()):g.error("Failed to delete subject")}catch(d){console.error("Error deleting subject:",d),g.error("Failed to delete subject")}},Z=s=>{l(s),n(!0)},B=()=>{j(),n(!1),l(null)},ee=s=>{const d=u.find(v=>v.id===s);return d?`Semester ${d.semesterNo} (${d.year})`:"Unknown Semester"},se=s=>({"A+":"text-green-700 bg-green-100",A:"text-green-700 bg-green-100","A-":"text-green-600 bg-green-50","B+":"text-blue-700 bg-blue-100",B:"text-blue-600 bg-blue-50","B-":"text-blue-500 bg-blue-50","C+":"text-yellow-700 bg-yellow-100",C:"text-yellow-600 bg-yellow-50","C-":"text-yellow-500 bg-yellow-50","D+":"text-orange-700 bg-orange-100",D:"text-orange-600 bg-orange-50",F:"text-red-700 bg-red-100"})[s]||"text-gray-600 bg-gray-50",H=N.filter(s=>{const d=s.name.toLowerCase().includes(x.toLowerCase())||s.code.toLowerCase().includes(x.toLowerCase()),v=p==="all"||s.semesterId===p;return d&&v});return w?e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{onDataCleared:j}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,d)=>e.jsxs(T,{children:[e.jsxs(G,{children:[e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]}),e.jsxs(I,{children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded"})]})]},d))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{onDataCleared:j}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(f,{placeholder:"Search subjects...",value:x,onChange:s=>h(s.target.value),className:"pl-10"})]}),e.jsxs(E,{value:p,onValueChange:M,children:[e.jsx(z,{className:"w-48",children:e.jsx(D,{placeholder:"Filter by semester"})}),e.jsxs(F,{children:[e.jsx(C,{value:"all",children:"All Semesters"}),u.map(s=>e.jsxs(C,{value:s.id,children:["Semester ",s.semesterNo," (",s.year,")"]},s.id))]})]})]}),e.jsxs(P,{open:m,onOpenChange:n,children:[e.jsx(_,{asChild:!0,children:e.jsxs(b,{onClick:()=>l(null),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Add Subject"]})}),e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(U,{children:t?"Edit Subject":"Add New Subject"}),e.jsx(Q,{children:t?"Update subject information and grades":"Add a new subject to track your academic performance"})]}),e.jsx(K,{subject:t,semesters:u,onSave:B,onCancel:()=>{n(!1),l(null)}})]})]})]}),H.length===0?e.jsx(T,{children:e.jsxs(I,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("div",{className:"text-muted-foreground mb-4",children:N.length===0?"No subjects found":"No subjects match your search"}),N.length===0&&u.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"You need to create a semester first before adding subjects."}),u.length>0&&e.jsxs(P,{open:m,onOpenChange:n,children:[e.jsx(_,{asChild:!0,children:e.jsxs(b,{onClick:()=>l(null),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Add Your First Subject"]})}),e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(U,{children:"Add New Subject"}),e.jsx(Q,{children:"Add a new subject to track your academic performance"})]}),e.jsx(K,{subject:null,semesters:u,onSave:B,onCancel:()=>{n(!1),l(null)}})]})]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(s=>e.jsxs(T,{className:"flex flex-col",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(oe,{className:"line-clamp-2",children:s.name}),e.jsxs(me,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-mono text-sm",children:s.code}),e.jsx("span",{className:"text-xs",children:ee(s.semesterId)})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Z(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>X(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(je,{className:"h-4 w-4"})})]})]})}),e.jsxs(I,{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Credit Hours"}),e.jsx(R,{variant:"outline",children:s.creditHours})]}),s.useComponents&&e.jsxs("div",{className:"text-xs space-y-1 py-2 border-t border-b",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Assignment (10%):"}),e.jsxs("span",{children:[s.assignment||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quizzes (15%):"}),e.jsxs("span",{children:[s.quizzes||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mid Exam (25%):"}),e.jsxs("span",{children:[s.midExam||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Final Exam (50%):"}),e.jsxs("span",{children:[s.finalExam||0,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Marks"}),e.jsxs("span",{className:"font-medium",children:[s.marks.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grade"}),e.jsx(R,{variant:"secondary",className:se(s.grade),children:s.grade})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4",children:["Updated ",new Date(s.updatedAt).toLocaleDateString()]})]})]},s.id))})]})}export{Se as SubjectList};
