import{c as P,u as S,r as c,j as e,C as b,b as L,d as T,e as k,g as D,t as i,p as _,al as E,am as R,an as O,ao as K,ap as B,F as q,B as F}from"./index-xKifkbJu.js";import{P as V}from"./progress-BvI071EH.js";import{U as z}from"./upload-C6yA1IZy.js";import{D as $}from"./download-CjHMZWAk.js";import{T as H}from"./trash-2-BvwvbQeQ.js";import{I as W}from"./image-gKty-gUU.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Z=P("ellipsis",Y);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],j=P("file",G);function J({onUploadSuccess:f,accept:o="image/*,.pdf",maxSize:l=10485760,className:d=""}){const{session:m}=S(),[n,w]=c.useState(!1),[N,u]=c.useState(0),[M,x]=c.useState(!1),v=c.useRef(null),C=r=>["image/jpeg","image/jpg","image/png","image/gif","image/webp","application/pdf"].includes(r.type)?r.size>l?(i.error(`File size too large. Maximum size is ${Math.round(l/1024/1024)}MB.`),!1):!0:(i.error("File type not allowed. Please upload images or PDF files only."),!1),U=async r=>{if(C(r)){if(!m?.access_token){i.error("You must be logged in to upload files");return}w(!0),u(0);try{const t=new FormData;t.append("file",r);const g=await fetch(`https://${_}.supabase.co/functions/v1/make-server-0603cad1/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${m.access_token}`},body:t});if(!g.ok){const I=await g.json();throw new Error(I.error||"Upload failed")}const y=await g.json();u(100),i.success("File uploaded successfully!"),f?.(y)}catch(t){console.error("Upload error:",t),i.error(t instanceof Error?t.message:"Failed to upload file")}finally{w(!1),u(0)}}},s=r=>{if(!r||r.length===0)return;const t=r[0];U(t)},a=r=>{r.preventDefault(),x(!0)},h=r=>{r.preventDefault(),x(!1)},p=r=>{r.preventDefault(),x(!1);const t=r.dataTransfer.files;s(t)},A=r=>{if(r===0)return"0 Bytes";const t=1024,g=["Bytes","KB","MB"],y=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,y)).toFixed(2))+" "+g[y]};return e.jsxs(b,{className:d,children:[e.jsx(L,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Upload File"]})}),e.jsxs(k,{children:[e.jsx("div",{className:`
            border-2 border-dashed rounded-lg p-6 text-center transition-colors
            ${M?"border-primary bg-primary/5":"border-muted-foreground/25"}
            ${n?"pointer-events-none opacity-50":"cursor-pointer hover:border-primary hover:bg-primary/5"}
          `,onDragOver:a,onDragLeave:h,onDrop:p,onClick:()=>v.current?.click(),children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-3",children:n?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}):e.jsx(z,{className:"h-6 w-6 text-primary"})}),n?e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Uploading..."}),e.jsx(V,{value:N,className:"w-full"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Drop files here or click to browse"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Supports images and PDF files up to ",A(l)]})]}),e.jsxs(D,{variant:"outline",size:"sm",disabled:n,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Choose File"]})]})]})}),e.jsx("input",{ref:v,type:"file",accept:o,onChange:r=>s(r.target.files),className:"hidden",disabled:n})]})]})}function Q({onFileDeleted:f}){const{session:o}=S(),[l,d]=c.useState([]),[m,n]=c.useState(!0);c.useEffect(()=>{o?.access_token&&w()},[o]);const w=async()=>{if(!o?.access_token){n(!1);return}try{const s=await fetch(`https://${_}.supabase.co/functions/v1/make-server-0603cad1/files`,{headers:{Authorization:`Bearer ${o.access_token}`}});if(!s.ok)throw new Error("Failed to fetch files");const a=await s.json();d(a)}catch(s){console.error("Fetch files error:",s),i.error("Failed to load files")}finally{n(!1)}},N=s=>{if(s.signedUrl){const a=document.createElement("a");a.href=s.signedUrl,a.download=s.fileName,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else i.error("File URL not available")},u=s=>{s.signedUrl?window.open(s.signedUrl,"_blank"):i.error("File URL not available")},M=async(s,a)=>{if(confirm(`Are you sure you want to delete "${a}"?`)){if(!o?.access_token){i.error("You must be logged in to delete files");return}try{if(!(await fetch(`https://${_}.supabase.co/functions/v1/make-server-0603cad1/files/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${o.access_token}`}})).ok)throw new Error("Failed to delete file");d(l.filter(p=>p.id!==s)),i.success("File deleted successfully"),f?.()}catch(h){console.error("Delete file error:",h),i.error("Failed to delete file")}}},x=s=>{if(s===0)return"0 Bytes";const a=1024,h=["Bytes","KB","MB"],p=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,p)).toFixed(2))+" "+h[p]},v=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=s=>s?s.startsWith("image/")?e.jsx(W,{className:"h-5 w-5 text-blue-500"}):s==="application/pdf"?e.jsx(q,{className:"h-5 w-5 text-red-500"}):e.jsx(j,{className:"h-5 w-5 text-gray-500"}):e.jsx(j,{className:"h-5 w-5 text-gray-500"}),U=s=>s?s.startsWith("image/")?e.jsx(F,{variant:"secondary",children:"Image"}):s==="application/pdf"?e.jsx(F,{variant:"destructive",children:"PDF"}):e.jsx(F,{variant:"outline",children:"File"}):e.jsx(F,{variant:"outline",children:"File"});return m?e.jsx(b,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading files..."})]})})}):o?.access_token?e.jsxs(b,{children:[e.jsx(L,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"My Files (",l.length,")"]})}),e.jsx(k,{children:l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No files uploaded"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload your first file to get started."})]}):e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[C(s.fileType),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.fileName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:x(s.fileSize)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:v(s.createdAt)}),e.jsx("span",{children:"•"}),U(s.fileType)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>u(s),children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>N(s),children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs(R,{children:[e.jsx(O,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(K,{align:"end",children:[e.jsxs(B,{onClick:()=>u(s),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsxs(B,{onClick:()=>N(s),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Download"]}),e.jsxs(B,{onClick:()=>M(s.id,s.fileName),className:"text-destructive",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]},s.id))})})]}):e.jsx(b,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground",children:"Please log in to view your files."})]})})})}function ne(){const{session:f}=S(),[o,l]=c.useState(0),d=c.useCallback(()=>{l(n=>n+1)},[]),m=c.useCallback(()=>{l(n=>n+1)},[]);return f?.access_token?e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{onUploadSuccess:d}),e.jsx(Q,{onFileDeleted:m},o)]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Please log in to access file management."})})}export{ne as FileManager};
