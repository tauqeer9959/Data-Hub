import{u as M,r as u,j as e,y as k,I as C,z as X,g as o,B as _,$ as z,p as D,t as j,C as F,b as U,e as $,D as I,E as O,H as G,J as H,K as q,M as J,d as Y,o as Q,a0 as V}from"./index-xKifkbJu.js";import{P as E,S as Z}from"./square-pen-DwbjdNbe.js";import{U as ee}from"./upload-C6yA1IZy.js";import{I as se}from"./image-gKty-gUU.js";import{S as te}from"./search-DzMNDHdN.js";import{T as ae}from"./trash-2-BvwvbQeQ.js";import{E as re}from"./external-link-BS7R7yCb.js";function K({project:r,onSave:N,onCancel:L}){const{session:f}=M(),[c,x]=u.useState(!1),[l,d]=u.useState({title:"",description:"",techTags:[],links:[],screenshots:[]}),[h,y]=u.useState(""),[m,v]=u.useState("");u.useEffect(()=>{r&&d({title:r.title,description:r.description,techTags:r.techTags,links:r.links,screenshots:r.screenshots||[]})},[r]);const T=s=>{const{name:a,value:i}=s.target;d(g=>({...g,[a]:i}))},P=()=>{h.trim()&&!l.techTags.includes(h.trim())&&(d(s=>({...s,techTags:[...s.techTags,h.trim()]})),y(""))},S=s=>{d(a=>({...a,techTags:a.techTags.filter(i=>i!==s)}))},w=()=>{m.trim()&&!l.links.includes(m.trim())&&(d(s=>({...s,links:[...s.links,m.trim()]})),v(""))},t=s=>{d(a=>({...a,links:a.links.filter(i=>i!==s)}))},n=async s=>{const a=s.target.files;if(!(!a||a.length===0||!f?.access_token)){x(!0);try{const i=Array.from(a).map(async p=>{if(!["image/jpeg","image/png","image/jpg","image/webp"].includes(p.type))throw new Error("Please select only image files");if(p.size>10485760)throw new Error("File size must be less than 10MB");const B=new FormData;B.append("file",p);const A=await fetch(`https://${D}.supabase.co/functions/v1/make-server-0603cad1/files/upload`,{method:"POST",headers:{Authorization:`Bearer ${f.access_token}`},body:B});if(!A.ok){const W=await A.json();throw new Error(W.error||"Upload failed")}return(await A.json()).file_path}),g=await Promise.all(i);d(p=>({...p,screenshots:[...p.screenshots,...g]})),j.success(`${g.length} screenshot(s) uploaded successfully`)}catch(i){console.error("Error uploading screenshots:",i),j.error(i instanceof Error?i.message:"Failed to upload screenshots")}finally{x(!1)}}},b=s=>{d(a=>({...a,screenshots:a.screenshots.filter(i=>i!==s)}))},R=async s=>{if(s.preventDefault(),!!f?.access_token){x(!0);try{const a=r?`https://${D}.supabase.co/functions/v1/make-server-0603cad1/projects/${r.id}`:`https://${D}.supabase.co/functions/v1/make-server-0603cad1/projects`,g=await fetch(a,{method:r?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f.access_token}`},body:JSON.stringify({title:l.title,description:l.description,techTags:l.techTags,links:l.links,screenshots:l.screenshots})});if(g.ok)j.success(r?"Project updated successfully":"Project created successfully"),N();else{const p=await g.json();j.error(p.error||"Failed to save project")}}catch(a){console.error("Error saving project:",a),j.error("Failed to save project")}finally{x(!1)}}};return e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"title",children:"Project Title"}),e.jsx(C,{id:"title",name:"title",value:l.title,onChange:T,placeholder:"Enter project title",required:!0,disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"description",children:"Description"}),e.jsx(X,{id:"description",name:"description",value:l.description,onChange:T,placeholder:"Describe your project...",rows:4,required:!0,disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Technologies Used"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:h,onChange:s=>y(s.target.value),placeholder:"Add technology (e.g., React, Node.js)",disabled:c,onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),P())}}),e.jsx(o,{type:"button",onClick:P,disabled:c||!h.trim(),children:e.jsx(E,{className:"h-4 w-4"})})]}),l.techTags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.techTags.map((s,a)=>e.jsxs(_,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 w-4 h-4",onClick:()=>S(s),disabled:c,children:e.jsx(z,{className:"h-3 w-3"})})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Project Links"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:m,onChange:s=>v(s.target.value),placeholder:"Add project link (GitHub, Demo, etc.)",type:"url",disabled:c,onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),w())}}),e.jsx(o,{type:"button",onClick:w,disabled:c||!m.trim(),children:e.jsx(E,{className:"h-4 w-4"})})]}),l.links.length>0&&e.jsx("div",{className:"space-y-2 mt-2",children:l.links.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:"flex-1 text-sm truncate",children:s}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>t(s),disabled:c,children:e.jsx(z,{className:"h-4 w-4"})})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Project Screenshots"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{type:"file",multiple:!0,accept:"image/*",onChange:n,disabled:c,className:"hidden",id:"screenshot-upload"}),e.jsxs(o,{type:"button",variant:"outline",onClick:()=>document.getElementById("screenshot-upload")?.click(),disabled:c,className:"w-full",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Upload Screenshots"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supported formats: JPG, PNG, WebP (max 10MB each)"})]}),l.screenshots.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:l.screenshots.map((s,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-video bg-muted rounded-lg border flex items-center justify-center",children:e.jsx(se,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx(o,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>b(s),disabled:c,children:e.jsx(z,{className:"h-3 w-3"})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:["Screenshot ",a+1]})]},a))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:L,disabled:c,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:c||!l.title.trim(),children:c?"Saving...":r?"Update Project":"Create Project"})]})]})}function xe(){const{session:r}=M(),[N,L]=u.useState([]),[f,c]=u.useState(!0),[x,l]=u.useState(""),[d,h]=u.useState(null),[y,m]=u.useState(!1),v=async()=>{if(r?.access_token)try{const t=await fetch(`https://${D}.supabase.co/functions/v1/make-server-0603cad1/projects`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(t.ok){const n=await t.json();L(n)}else console.error("Failed to fetch projects")}catch(t){console.error("Error fetching projects:",t)}finally{c(!1)}};u.useEffect(()=>{v()},[r]);const T=async t=>{if(!(!r?.access_token||!confirm("Are you sure you want to delete this project?")))try{(await fetch(`https://${t}.supabase.co/functions/v1/make-server-0603cad1/projects/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.access_token}`}})).ok?(j.success("Project deleted successfully"),v()):j.error("Failed to delete project")}catch(n){console.error("Error deleting project:",n),j.error("Failed to delete project")}},P=t=>{h(t),m(!0)},S=()=>{v(),m(!1),h(null)},w=N.filter(t=>t.title.toLowerCase().includes(x.toLowerCase())||t.description.toLowerCase().includes(x.toLowerCase())||t.techTags.some(n=>n.toLowerCase().includes(x.toLowerCase())));return f?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-10 w-24 bg-muted rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((t,n)=>e.jsxs(F,{children:[e.jsxs(U,{children:[e.jsx("div",{className:"h-6 w-3/4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded"})]}),e.jsxs($,{children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded mb-2"}),e.jsx("div",{className:"h-4 w-2/3 bg-muted rounded"})]})]},n))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(C,{placeholder:"Search projects...",value:x,onChange:t=>l(t.target.value),className:"pl-10"})]}),e.jsxs(I,{open:y,onOpenChange:m,children:[e.jsx(O,{asChild:!0,children:e.jsxs(o,{onClick:()=>h(null),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Add Project"]})}),e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(q,{children:d?"Edit Project":"Add New Project"}),e.jsx(J,{children:d?"Update your project information":"Add a new project to your portfolio"})]}),e.jsx(K,{project:d,onSave:S,onCancel:()=>{m(!1),h(null)}})]})]})]}),w.length===0?e.jsx(F,{children:e.jsxs($,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"text-muted-foreground mb-4",children:N.length===0?"No projects found":"No projects match your search"}),N.length===0&&e.jsxs(I,{open:y,onOpenChange:m,children:[e.jsx(O,{asChild:!0,children:e.jsxs(o,{onClick:()=>h(null),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Add Your First Project"]})}),e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(q,{children:"Add New Project"}),e.jsx(J,{children:"Add a new project to your portfolio"})]}),e.jsx(K,{project:null,onSave:S,onCancel:()=>{m(!1),h(null)}})]})]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(t=>e.jsxs(F,{className:"flex flex-col",children:[e.jsxs(U,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Y,{className:"line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>P(t),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>T(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(ae,{className:"h-4 w-4"})})]})]}),e.jsx(Q,{className:"line-clamp-3",children:t.description})]}),e.jsxs($,{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-4",children:[t.techTags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.techTags.slice(0,6).map((n,b)=>e.jsx(_,{variant:"secondary",className:"text-xs",children:n},b)),t.techTags.length>6&&e.jsxs(_,{variant:"outline",className:"text-xs",children:["+",t.techTags.length-6]})]}),t.links.length>0&&e.jsx("div",{className:"flex gap-2",children:t.links.slice(0,2).map((n,b)=>e.jsx(o,{variant:"outline",size:"sm",asChild:!0,className:"text-xs",children:e.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:[n.includes("github.com")?e.jsx(V,{className:"h-3 w-3 mr-1"}):e.jsx(re,{className:"h-3 w-3 mr-1"}),n.includes("github.com")?"GitHub":"Demo"]})},b))})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-4",children:["Updated ",new Date(t.updatedAt).toLocaleDateString()]})]})]},t.id))})]})}export{xe as ProjectList};
